<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ChatDAO">


<!-- 상세내용 -->
	<select id="getSearch" parameterType="chat"
		resultType="search">
		select search_id as "searchId",
				user_id as "userId",
				title as "title",
				contents as "contents",
				write_date as "writeDate"
		from  search
		where search_id = #{searchId}
	</select>

<!-- 키워드 등록 -->
	<insert id="insertChat" parameterType="chat">
		<selectKey keyProperty="chatId" resultType="int"
			order="BEFORE">
			select NVL(max(chat_id),0) +1 from chat

			<!-- select NVL(max(search_id),1) +1 from search -->
		</selectKey>
		insert into chat(chat_id
							,user_id
							,nickname
							,contents
		)

		values(  #{chatId}
				,#{userId}
				,#{nickname}
				,#{contents}
		)
	</insert>

<!-- 전체조회 -->
	<select id="chatList" resultType="chat">
		select * from chat 
		order by
		chat_id desc
	</select>


<!-- 전체조회2 -->
	<select id="chatMap" resultType="map">
		select chat_id as "chatId",
			   user_id as "userId", 
			   nickname as "nickname",
			   contents as "contents",
			   to_char(write_date, 'YY/MM/DD') as "writeDate"
		from chat
	<where>
		<if test="contents != null and contents != ''">
			and contents like '%' || #{contents} || '%'
		</if>
	</where>
	<choose>
		<when test="orderby != null and orderby != ''">
			order by #{orderby} desc
		</when>
		<otherwise>
			order by chat_id desc
		</otherwise>
	</choose>
	</select>

</mapper>